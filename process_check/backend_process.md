# EchoMap 后端功能全景梳理

本文档基于用户全流程视角，梳理后端已实现、部分实现及待开发的功能模块。

**状态图例：**
- ✅ **[已实现]**: 代码逻辑已完成，接口可调用。
- ⚠️ **[部分实现/Mock]**: 接口存在，但核心逻辑使用假数据或占位符。
- 📝 **[待开发]**: 目前代码中尚未包含此功能。

---

## 1. 用户身份与管理 (User Identity)
*用户进入应用后的第一步，建立身份标识。*

| 状态 | 功能点 | 描述 | 当前现状/备注 |
| :--- | :--- | :--- | :--- |
| ✅ | **用户注册** | 接收用户名、邮箱，创建用户记录。 | `POST /users/` 已实现，包含邮箱/用户名查重。 |
| ✅ | **获取用户信息** | 根据 ID 获取用户资料。 | `GET /users/{user_id}` 已实现。 |
| ✅ | **获取用户历史** | 查看“我”发布过的所有声音记录。 | `GET /users/{user_id}/records` 已实现。 |
| 📝 | **用户认证 (Auth)** | 登录、JWT Token 生成与校验。 | 目前仅通过 `user_id` 关联，无密码/Token 验证机制。 |

## 2. 声音采集与上传 (Capture & Upload)
*用户录制声音并上传到服务器的过程。*

| 状态 | 功能点 | 描述 | 当前现状/备注 |
| :--- | :--- | :--- | :--- |
| ✅ | **音频文件上传** | 接收 `multipart/form-data` (文件+经纬度)。 | `POST /api/v1/records/upload` 已实现。 |
| ✅ | **文件存储** | 将音频文件保存到服务器本地磁盘。 | 存储于 `backend/static/uploads`，提供静态资源访问。 |
| 📝 | **音频元数据提取** | 自动获取音频时长、格式、采样率。 | 数据库 `duration` 字段目前存为 0，需引入 `ffmpeg` 处理。 |

## 3. AI 大脑处理流水线 (AI Processing Pipeline)
*核心差异化功能，用户上传后后台异步处理的过程。*

| 状态 | 功能点 | 描述 | 当前现状/备注 |
| :--- | :--- | :--- | :--- |
| ✅ | **异步任务调度** | 上传接口立即返回，后台开启线程处理 AI 任务。 | 使用 `FastAPI.BackgroundTasks` 实现。 |
| ✅ | **外部音频分析** | 调用 GPUHub API 获取转录 (Transcript) 和基础情感。 | `AIService` 已集成外部 API。 |
| ✅ | **叙事与标签生成** | 调用 LLM (DeepSeek) 生成“声音故事”和“场景标签”。 | `AIService` 已集成 LLM Prompt 逻辑。 |
| ⚠️ | **向量化 (Embedding)** | 将音频/文本转化为向量，用于后续匹配。 | **目前为 Mock 数据** (`[0.1] * 768`)，需接入真实 Embedding 模型。 |

## 4. 地图探索与发现 (Map Exploration)
*用户在地图上浏览声音锚点。*

| 状态 | 功能点 | 描述 | 当前现状/备注 |
| :--- | :--- | :--- | :--- |
| ✅ | **视口区域查询** | 根据地图可视范围 (Bounds) 返回声音点。 | `GET /api/v1/records/map` 已实现，基于 PostGIS。 |
| ✅ | **获取最新发布** | 展示全网最新上传的声音。 | `GET /api/v1/records/latest` 已实现。 |
| 📝 | **聚合/聚类** | 地图缩放级别小时，聚合密集点以提升性能。 | 目前返回所有点，数据量大时会有性能瓶颈。 |

## 5. 详情与共鸣 (Detail & Resonance)
*用户点击某个点，深入了解并寻找相似。*

| 状态 | 功能点 | 描述 | 当前现状/备注 |
| :--- | :--- | :--- | :--- |
| ✅ | **获取单条详情** | 返回音频播放 URL、完整故事、标签。 | `GET /api/v1/records/{record_id}` 已实现。 |
| 📝 | **相似声音推荐** | “寻找世界上的另一个我”，基于向量距离查找相似。 | 接口已定义但**未实现逻辑**，依赖于真实的 Embedding 数据。 |

## 6. 基础设施与运维 (Infrastructure)

| 状态 | 功能点 | 描述 | 当前现状/备注 |
| :--- | :--- | :--- | :--- |
| ✅ | **数据库架构// filepath: /Users/wenjiayi/code/Py/Dragon Raja/Neo3-1/BACKEND_FEATURES.md
